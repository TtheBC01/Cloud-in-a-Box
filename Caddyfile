{
        http_port 8888

        security {
                local identity store localdb {
                        realm local
                        path {$HOME}/.local/caddy/users.json
                }

                authentication portal myportal {
                        enable identity store localdb
                        crypto default token lifetime 3600
                        cookie domain *
                        cookie insecure on
                        ui {
                                links {
                                        "IDE" /ide/ icon "las la-star"
                                        "IPFS GUI" /webui/ icon "las la-star"
										"STATS" /glances/ icon "las la-star"
                                }
                        }
                }

                authorization policy admins_policy {
                        set auth url /auth
                        crypto default token lifetime 3600
                        allow roles authp/admin authp/user
                        acl rule {
                                comment allow users
                                match role authp/user
                                allow stop log info
                        }
                }
        }
}

:8888 {
        log
        route /auth* {
                authenticate with myportal
        }

        route /ide* {
                authorize with admins_policy
                uri strip_prefix /ide
                reverse_proxy http://127.0.0.1:8080
        }
		
		route /glances* {
                authorize with admins_policy
				uri strip_prefix /glances
                reverse_proxy http://glances:61208
        }

        route /ipfs* {
                authorize with admins_policy
                reverse_proxy http://ipfs_node:5001
        }
		
		route /api* {
                authorize with admins_policy
                reverse_proxy http://ipfs_node:5001
        }
		
		handle_path /gateway/* {
			reverse_proxy http://ipfs_node:8080
		}

        route /webui* {
                authorize with admins_policy
                reverse_proxy http://ipfs_node:5001
        }

        route {
                redir https://{hostport}/auth/ 302
        }
}